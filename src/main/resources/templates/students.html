<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Students Management</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>
    <link rel="stylesheet" th:href="@{/css/theme.css}" />
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .stats-card {
            border-radius: 15px;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .stats-card:hover {
            transform: translateY(-5px);
        }
        .main-card {
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .table-card {
            border-radius: 10px;
            overflow: hidden;
        }
        .table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .table tbody tr:hover {
            background-color: #f8f9fa;
            cursor: pointer;
        }
        .btn-view {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
        }
        .btn-view:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            color: white;
        }
        .search-box {
            border-radius: 25px;
            border: 2px solid #e9ecef;
            padding: 10px 20px;
        }
        .search-box:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .badge-gpa {
            font-size: 0.9em;
            padding: 5px 10px;
        }
        .gpa-excellent { background-color: #28a745; }
        .gpa-good { background-color: #17a2b8; }
        .gpa-average { background-color: #ffc107; color: #212529; }
        .gpa-poor { background-color: #dc3545; }
    </style>
</head>
<body class="app-shell">
    <div th:replace="fragments/header :: header"></div>

    <main class="main-content container">
    <!-- Dashboard / Hero -->
    <section class="row mb-4" role="region" aria-label="dashboard" tabindex="-1">
        <div class="col-lg-7 mb-3">
            <div class="container-card">
                <div class="card-header-hero d-flex align-items-center justify-content-between">
                    <div>
                        <h1 class="mb-1" style="font-weight:700;letter-spacing: -0.3px;">Students</h1>
                        <p class="muted-small mb-0">Overview of students and quick actions</p>
                    </div>
                    <div class="d-flex gap-2 align-items-center">
                        <a class="btn btn-primary-grad btn-round px-4" href="/add" aria-label="Add new student">
                            <i class="bi bi-plus-circle me-2"></i>Add Student
                        </a>
                        <a class="btn btn-outline-muted" href="/" aria-label="Refresh list">Refresh</a>
                    </div>
                </div>
                <div class="card-inner d-flex gap-3" style="padding:18px;">
                    <div class="stats-card-min" style="background:linear-gradient(90deg,#5A66F5,#4b54e6);flex:1">
                        <div class="stats-title" aria-hidden="true">Total Students</div>
                        <div class="stats-value" aria-live="polite" aria-atomic="true" th:text="${totalStudents}">0</div>
                    </div>
                    <div class="stats-card-min" style="background:linear-gradient(90deg,#f093fb,#f5576c);flex:1">
                        <div class="stats-title" aria-hidden="true">Average GPA</div>
                        <div class="stats-value" aria-live="polite" aria-atomic="true" th:text="${avgGpa != null ? #numbers.formatDecimal(avgGpa, 1, 2) : '0.00'}">0.00</div>
                    </div>
                    <div class="stats-card-min" style="background:linear-gradient(90deg,#4facfe,#00f2fe);flex:1">
                        <div class="stats-title" aria-hidden="true">Departments</div>
                        <div class="stats-value" aria-live="polite" aria-atomic="true" th:text="${departments != null ? departments.size() : 0}">0</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-5 mb-3">
            <!-- compact filters & stats -->
            <div class="container-card p-3" style="height:100%">
                <div class="card-inner">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <div class="muted-small mb-1">Top Courses</div>
                            <div class="fw-bold">Most Popular: <span th:text="${courses != null && courses.size()>0 ? courses.get(0) : '—'}">—</span></div>
                        </div>
                        <div>
                            <small class="muted-small">Updated just now</small>
                        </div>
                    </div>
                    <div class="alert-soft">
                        <small class="muted-small">Use search and filters to refine the list — keyboard accessible.</small>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Statistics Cards (legacy row kept below for backward compatibility) -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="card stats-card text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-white-50 mb-1">Total Students</h6>
                            <h2 class="mb-0" th:text="${totalStudents}">0</h2>
                        </div>
                        <div class="fs-1 opacity-50">
                            <i class="bi bi-people-fill"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card stats-card text-white" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-white-50 mb-1">Average GPA</h6>
                            <h2 class="mb-0" th:text="${avgGpa != null ? #numbers.formatDecimal(avgGpa, 1, 2) : '0.00'}">0.00</h2>
                        </div>
                        <div class="fs-1 opacity-50">
                            <i class="bi bi-star-fill"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card stats-card text-white" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-white-50 mb-1">Departments</h6>
                            <h2 class="mb-0" th:text="${departments != null ? departments.size() : 0}">0</h2>
                        </div>
                        <div class="fs-1 opacity-50">
                            <i class="bi bi-building"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Card -->
    <div class="card main-card">
        <div class="card-header bg-white border-0 pt-4 pb-3">
            <div class="d-flex justify-content-between align-items-center flex-wrap">
                <h3 class="mb-0">
                    <i class="bi bi-list-ul me-2"></i>Students List
                </h3>
                <a class="btn btn-primary" href="/add">
                    <i class="bi bi-plus-circle me-1"></i>Add New Student
                </a>
            </div>
        </div>
        <div class="card-body">
            <!-- Error Message -->
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <span th:text="${error}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            
            <!-- Search and Filter Section -->
            <form method="get" action="/" class="mb-4">
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-text bg-white">
                                <i class="bi bi-search"></i>
                            </span>
                            <input id="searchInput" type="text" class="form-control search-box" name="search" 
                                th:value="${search}" placeholder="Search by name, email, or student ID" aria-label="Search students">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" name="department" aria-label="Filter by department">
                            <option value="All">All Departments</option>
                            <option th:each="dept : ${departments != null ? departments : {}}" 
                                    th:value="${dept}" 
                                    th:text="${dept}"
                                    th:selected="${selectedDepartment != null and selectedDepartment == dept}"></option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" name="course" aria-label="Filter by course">
                            <option value="All">All Courses</option>
                            <option th:each="crs : ${courses != null ? courses : {}}" 
                                    th:value="${crs}" 
                                    th:text="${crs}"
                                    th:selected="${selectedCourse != null and selectedCourse == crs}"></option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-funnel me-1"></i>Filter
                        </button>
                    </div>
                </div>
                <div class="mt-2" th:if="${(search != null) or (selectedDepartment != null and selectedDepartment != 'All') or (selectedCourse != null and selectedCourse != 'All')}">
                    <a href="/" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-x-circle me-1"></i>Clear Filters
                    </a>
                </div>
            </form>

            <!-- Students Table -->
            <div class="table-responsive table-card" role="region" aria-label="students table">
                <table class="table table-hover align-middle mb-0" role="table" aria-describedby="studentsTableCaption">
                    <caption id="studentsTableCaption" class="visually-hidden">List of students including ID, name, age, email, phone, course, department and GPA</caption>
                    <thead>
                    <tr>
                        <th>Student ID</th>
                <th>Name</th>
                <th>Age</th>
                        <th>Email</th>
                        <th>Phone</th>
                <th>Course</th>
                        <th>Department</th>
                        <th>GPA</th>
                <th class="text-center">Actions</th>
            </tr>
            </thead>
            <tbody>
                    <tr th:each="s : ${students}" th:onclick="'window.location.href=\'/view/' + ${s.id} + '\''">
                        <td>
                            <strong th:text="${s.studentId != null ? s.studentId : 'N/A'}"></strong>
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="avatar-sm bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" 
                                     style="width: 35px; height: 35px; font-size: 14px;"
                                     th:text="${s.name != null ? (#strings.isEmpty(s.name) ? '?' : #strings.substring(s.name, 0, 1).toUpperCase()) : '?'}"></div>
                                <div>
                                    <div class="fw-bold" th:text="${s.name != null ? s.name : 'N/A'}"></div>
                                    <small class="text-muted" th:text="${s.gender != null ? s.gender : ''}"></small>
                                </div>
                            </div>
                        </td>
                        <td th:text="${s.age != null ? s.age : 'N/A'}"></td>
                        <td>
                            <small th:text="${s.email != null ? s.email : 'N/A'}"></small>
                        </td>
                        <td th:text="${s.phone != null ? s.phone : 'N/A'}"></td>
                        <td>
                            <span class="badge bg-info" th:text="${s.course != null ? s.course : 'N/A'}"></span>
                        </td>
                        <td>
                            <span class="badge bg-secondary" th:text="${s.department != null ? s.department : 'N/A'}"></span>
                        </td>
                        <td>
                            <span th:if="${s.gpa != null}" 
                                  class="badge badge-gpa" 
                                  th:classappend="${s.gpa >= 3.5} ? 'gpa-excellent' : (${s.gpa >= 3.0} ? 'gpa-good' : (${s.gpa >= 2.0} ? 'gpa-average' : 'gpa-poor'))"
                                  th:text="${#numbers.formatDecimal(s.gpa, 1, 2)}"></span>
                            <span th:if="${s.gpa == null}" class="text-muted">N/A</span>
                        </td>
                        <td class="text-center" onclick="event.stopPropagation();">
                            <div class="btn-group btn-group-sm" role="group">
                                <a class="btn btn-view btn-sm" th:href="@{'/view/' + ${s.id}}" title="View Details">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a class="btn btn-outline-primary btn-sm" th:href="@{'/edit/' + ${s.id}}" title="Edit">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a class="btn btn-outline-danger btn-sm" data-delete-url th:href="@{'/delete/' + ${s.id}}" title="Delete">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(students)}">
                        <td colspan="9" class="text-center py-5">
                            <div class="text-muted">
                                <i class="bi bi-inbox fs-1 d-block mb-3"></i>
                                <h5>No students found</h5>
                                <p>Try adjusting your search or filters, or add a new student.</p>
                                <a href="/add" class="btn btn-primary mt-2">
                                    <i class="bi bi-plus-circle me-1"></i>Add First Student
                                </a>
                            </div>
                        </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
    </div>
</div>

</main>

    <div th:replace="fragments/footer :: footer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/app.js}"></script>
</body>
</html>
</body>
</html>
